<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>WEB SERVICES with JAX-WS & Spring (in ACE Academy)</title>

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="../reveal.js/dist/reveal.css">
		<link rel="stylesheet" href="../reveal.js/dist/theme/blood.css" id="blood">
		<link rel="stylesheet" href="../reveal.js/plugin/highlight/monokai.css">
	</head>
	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>WEB SERVICES</h1>
					<h3>SOAP (JAX-WS & CXF)</h3>
					<h3>Microservices + REST</h3>
					<p>
						<small>Created by <a href="http://cz.linkedin.com/in/arnosthavelka/">Arno≈°t Havelka</a></small>
					</p>
				</section>

				<section>
					<h2>About me</h2>
					<ol>
						<li>Job title: <strong>Solution Architect</strong></li>
						<li>O2 employment: <strong>Since 1/2015</strong></li>
						<li>Certifications:<br/>
							<img src="img/scjp.jpg" alt="Sun Certified Programmer for the Java Platform, Standard Edition 6 (5/2010)">
							<img src="img/owsd.gif" alt="Oracle Certified Professional, Java EE 5 Web Services Developer (12/2010)">
							<img src="img/ojpad.gif" alt="Oracle Certified Expert, Java EE 6 Java Persistence API Developer (5/2014)">
							<img src="img/owcd.gif" alt="Oracle Certified Expert, Java EE 6 Web Component Developer (5/2015)"><br/>
							<img src="img/spring.jpg" alt="Spring Core 3.0 (7/2013)"><br/>
						</li>
					</ol>
				</section>
				
				<!--section>
					<h2>TODO</h2>
					<ol>
						<li>Exposing WS as spring exporter</li>
						<li>Exposing WS in different environments (JBoss/WildFly, Tomcat, Spring boot, Endpoint publisher, etc.)</li>
					</ol>
					- difference between xsd:import and xsd:include (http://stackoverflow.com/questions/2357943/whats-the-difference-between-xsdinclude-and-xsdimport)
				</section-->

				<section>
					<h2>Agenda</h2>
					<ol>
						<li>Basic theory</li>
						<li>WSDL & XSD</li>
						<li>JAX-WS</li>
						<li>CXF</li>
						<li>Implementation (including testing)</li>
						<li>Exposing WS in different setups</li>
						<li>Microservices</li>
						<li>REST</li>
					</ol>
				</section>

				<section>
					<section>
						<h2>1. Basic theory</h2>
						<ol>
							<li>Definition of webservice</li>
							<li>JAX-WS</li>
							<li>WS-I</li>
							<li>WSDL (MEP, RPC vs. Document)</li>
							<li>Advanced standards (MTOM, WS-*)</li>
						</ol>
					</section>
					<section>
						<h3>1.1 Definition of webservice</h3>
						<ul>
							<li><a href="http://en.wikipedia.org/wiki/Web_service" alt="Definition of webservice on Wikipedia">Wikipedia</a> defines webservice as 
								<q>a software system designed to support interoperable machine-to-machine interaction over a network.</q></li>
							<li>Basic types:
								<ul>
									<li><a href="http://en.wikipedia.org/wiki/SOAP" alt="Definition of Soap WS on Wikipedia">Soap</a> - Simple Object Access Protocol</li>
									<li><a href="http://en.wikipedia.org/wiki/Representational_state_transfer" alt="Definition of Rest WS on Wikipedia">Rest</a> - Representational state transfer (out of scope)</li>
								</ul>
							</li>
							<li><a href="http://ws-i.org" alt="Web of WS-I">WS-I Basic Profile</a> - defines basic rules to allow interoperability between different
							systems, technologies, etc.</li>
						</ul>
						<aside class="notes">
							<p>
								<strong>Soap</strong> - XML-based, defined by WSDL
								underlying protoco: HTTP/JMS
							</p>
							<p>
								<strong>rest</strong> - no XML-based, no required interface definition<br/>
								based on HTTP methods GET/PUT (update)/POST (insert)/DELETE<br/>
								stateless, cacheable, etc.
							</p>
						</aside>
					</section>
					<section>
						<h3>1.2 JAX-WS</h3>
						<ul>
							<li><a href="http://en.wikipedia.org/wiki/Java_API_for_XML_Web_Services" alt="Link of JAX-WS on Wikipedia">JAX-WS</a> (Java API for XML Web Services) is Java specification 
							(<a href="http://jcp.org/en/jsr/detail?id=224" alt="Link to JSR-224">JSR-224</a>) of webservices.</li>
							<li>Vendors: Metro project (reference implementation), CXF, Axis, Oracle Weblogic, etc.</li>
							<li>Related technologies: JAX-B (XML binding), SAAJ (SOAP with Attachments API for Java), etc.</li>
							<li>Specifications in JavaEE:
								<table style="border: 1px solid white;">
									<tr style="background-color: gray;">
										<th>Name</th>
										<th><a href="http://www.oracle.com/technetwork/java/javaee/tech/javaee5-jsp-135162.html" alt="List of technologies in JavaEE 5">JavaEE 5</a></th>
										<th><a href="http://www.oracle.com/technetwork/java/javaee/tech/index.html" alt="List of technologies in JavaEE 6 & 7">JavaEE 6 & 7</a></th>
									</tr>
									<tr>
										<td>JAX-WS</td>
										<td>2.0</td>
										<td>2.2</td>
									</tr>
									<tr>
										<td>JAX-RPC</td>
										<td>1.1</td>
										<td>1.1</td>
									</tr>
									<tr>
										<td>JAX-B</td>
										<td>2.0</td>
										<td>2.2</td>
									</tr>
									<tr>
										<td>SOAP</td>
										<td>1.2</td>
										<td>1.2</td>
									</tr>
									<tr>
										<td>WSDL</td>
										<td>1.1</td>
										<td>1.1</td>
									</tr>
								</table>
							</li>
					</section>
					<section>
						<h3>1.3 WSDL - Basics [1/2]</h3>
						<ul>
							<li>WSDL is abbreviation of <q>Web Services Metadata for the Java Platform</q>.</li>
							<li>MEP types:
								<ul>
									<li><strong style="color:yellow">Request/response</strong> - the endpoint receives a message and sends a correlated message.</li>
									<li><strong>One-way</strong> - the endpoint receives a message.</li>
									<li><strong>Solicit-response</strong> - the endpoint sends a message and receives a correlated message.</li>
									<li><strong>Notification</strong> - the endpoint sends a message.</li>
								</ul>
							</li>
						</ul>
					</section>
					<section>
						<h3>1.3 WSDL - Styles [2/2]</h3>				
						<ul>
							<li><strong>RPC/encoded</strong> - contains method name in request XML, but not WS-I compliant</li>
							<li><strong>RPC/literal</strong> - contains method name in request XML and WS-I compliant</li>
							<li><strong>Document/encoded</strong> - not WS-I compliant and not used</li>
							<li><strong style="color:yellow">Document/literal (wrapped)</strong> - WS-I compliant, valid-able, but more complicated</li>
						</ul>
						<p align="left"><br/>For more details look <a href="http://www.ibm.com/developerworks/library/ws-whichwsdl/">here</a>.</p>
						<aside class="notes">
							<p>
								<strong>WSDL style</strong> - every style has its strengths or weaknesses (e.g. performance, readability, etc.).
							</p>
						</aside>
					</section>
					<section>
						<h3>1.4 WS-I</h3>
						<ul>
							<li>It's an abbreviation (stands for) of Web Services Interoperability.</li>
							<li>It's a set of guidelines, best practices and test for interoperability (for heterogeneous systems).</li>
							<li>Last version of basic profile is 2.0. However usually used one is still version 1.2.</li>
						</li>
					</section>
					<section>
						<h3>1.5 Advanced standards (MTOM, WS-*)</h3>
						<ul>
							<li><strong>MTOM</strong> (<q>Message Transmission Optimization Mechanism</q>) - efficient sending binary data to and from WS, usually together with XOP (<q>XML-binary Optimized Packaging</q>). 
							Annotation has threshold to define size for using MTOM/XOP (otherwise it is sent normally).</li>
							<li><strong>WS-Addressing</strong> - a standardized way of including message routing data within SOAP headers</li>
							<li><strong>WS-Security</strong> - an extension to SOAP to apply security to Web services (XML Signature and XML Encryption)</li>
							<li><strong>WS-ReliableMessaging</strong> - a protocol that allows SOAP messages to be reliably delivered distributed system (between applications)</li>
							<li><a href="http://en.wikipedia.org/wiki/List_of_web_service_specifications" alt="List of web service specifications on Wikipedia">And more</a> (e.g. WS-Trust, WS-Coordination , WS-Transaction, WS-MetadataExchange)</li>
						</li>
					</section>
				</section>
				
				<section>
					<section>
						<h2>2. WSDL & XSD</h2>
						<ol>
							<li>Overview</li>
							<li>XSD Types (simple type, complex type)</li>
							<li>XSD Sequence + Attributes + Enums</li>
							<li>XSD Groups</li>
							<li>WSDL structure</li>
							<li>Namespace</li>
						</ol>
					</section>

					<section>
						<h2>2.1 Overview</h2>
						<p align="left"><strong>WSDL</strong> - contract of SOAP WS. It defines (or includes) types, operations/methods, services, binding, etc.</p>
						<p align="left"><strong>XSD</strong> - definition of XML types and elements</p>
					</section>

					<section>
						<h3>2.2 XSD Types (simple type, complex type)</h3>
						<h4>Simple type</h4>
						<pre><code class="xml"><xs:simpleType name="CustomChar">
    <xs:annotation>
        <xs:documentation xml:lang="cs">Documentation ...</xs:documentation>
    </xs:annotation>
    <xs:restriction base="xs:string">
        <xs:maxLength value="1"/>
    </xs:restriction>
</xs:simpleType></code></pre>
						<h4>Complex type + extension</h4>
						<pre><code class="xml"><xs:complexType name="ListItems">
    <xs:complexContent>
        <xs:extension base="CommonListAncestor">
            <xs:sequence>
                <xs:element name="item" type="ItemDefinition"  minOccurs="0" maxOccurs="unbounded"/>
            </xs:sequence>
        </xs:extension>
    </xs:complexContent>
</xs:complexType></code></pre>
					</section>

					<section>
						<h3>2.3 XSD Sequence + Attributes + Enums</h3>
						<h4>Sequence + Attributes</h4>
						<pre><code class="xml"><xs:complexType name="CustomFilter">
    <xs:sequence>
        <xs:element name="CodeInt" type="xs:int" minOccurs="0" maxOccurs="unbounded"></xs:element>
        <xs:element name="CodeString" type="xs:string" minOccurs="0" maxOccurs="unbounded"></xs:element>
    </xs:sequence>
    <xs:attribute name="FilterType" type="xs:string" default="SomeValue"></xs:attribute>
    <xs:attribute name="Validate" type="xs:boolean" default="false"></xs:attribute>
</xs:complexType></code></pre>
						<h4>Enums</h4>
						<pre><code class="xml"><xs:simpleType name="CustomEnum">
    <xs:restriction base="xs:string">
        <xs:enumeration value="Value1"></xs:enumeration>
        <xs:enumeration value="Value2"></xs:enumeration>
    </xs:restriction>
</xs:simpleType></code></pre>
					</section>

					<section>
						<h3>2.4 XSD Groups</h3>
						<h4>Definition</h4>
						<pre><code class="xml"><xs:group name="CustomGroup">
    <xs:sequence>
        <xs:element name="ElementA" type="xs:int"></xs:element>
        <xs:element name="ElementB" type="xs:string" minOccurs="0" maxOccurs="1"></xs:element>
    </xs:sequence>
</xs:group></code></pre>
						<h4>Usage</h4>
						<pre><code class="xml"><xs:group name="SmsPolozkyCiselnikuSimpleFiltrGroup">
    <xs:sequence>
        <xs:element name="ElementC" type="xs:string"></xs:element>
        <xs:group ref="CustomGroup"/>
    </xs:sequence>
</xs:group></code></pre>
					</section>
					
					<section>
						<h3>2.5 Namespace</h3>
						<h4>WSDL</h4>
						<pre><code class="xml"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<wsdl:definitions xmlns="urn:com:asseco:csu:abc:v1:ws:Custom" 
      xmlns:cty="urn:com:asseco:csu:abc:v1:type:Custom" 
	  targetNamespace="urn:com:asseco:csu:abc:v1:ws:Custom"
      xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/"
      name="SeznamObjektu">
        
    <wsdl:types>
        <xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema">
            <xsd:import namespace="urn:com:asseco:abc:v1:type:Custom" schemaLocation="../xsd/CustomType.xsd"></xsd:import>
        </xsd:schema>
    </wsdl:types>
	...
</code></pre>
						<h4>XSD</h4>
						<pre><code class="xml"><?xml version="1.0"?>
<xs:schema xmlns="urn:com:asseco:abc:v1:type:Custom" xmlns:common="urn:com:asseco:abc:v1:Common" targetNamespace="urn:com:asseco:abc:v1:type:Custom">
    <xs:import namespace="urn:com:asseco:abc:v1:Common" schemaLocation="xsd/CommonTypy.xsd"></xs:import>

	...
</code></pre>
						<small align="left">Note: <i>xs:include</i> is for types in same namespace, <i>xs:import</i> is for types from different namespace.</small>
					</section>

					<section>
						<h3>2.6 WSDL structure</h3>
<pre><code class="xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;wsdl:definitions xmlns="urn:com:asseco:abc:v1:ws:Custom" xmlns:cty="urn:com:asseco:abc:v1:type:Custom" targetNamespace="urn:com:asseco:abc:v1:ws:Custom"&gt;

    &lt;wsdl:types&gt;
        &lt;xsd:import namespace="urn:com:asseco:abc:v1:type:Custom" schemaLocation="../xsd/CustomType.xsd"/&gt;
    &lt;/wsdl:types&gt;

    &lt;wsdl:message name="AbcRequest"&gt;
        &lt;wsdl:part element="cty:AbcRequest" name="request"/&gt;
    &lt;/wsdl:message&gt;
    &lt;wsdl:message name="AbcResponse"&gt;
        &lt;wsdl:part element="cty:AbcResponse" name="response"/&gt;
    &lt;/wsdl:message&gt;

    &lt;wsdl:portType name="CustomPortType"&gt;
        &lt;wsdl:operation name="AbcMethod"&gt;
            &lt;wsdl:input message="AbcRequest"/&gt;
            &lt;wsdl:output message="AbcResponse"/&gt;
        &lt;/wsdl:operation&gt;
    &lt;/wsdl:portType&gt;

    &lt;wsdl:binding name="CustomBinding" type="CustomPortType"&gt;
        &lt;soap:binding style="document" transport="http://schemas.xmlsoap.org/soap/http"/&gt;
        &lt;wsdl:operation name="AbcMethod"&gt;
            &lt;soap:operation soapAction="AbcMethod"/&gt;
            &lt;wsdl:input&gt;&lt;soap:body use="literal"/&gt;&lt;/wsdl:input&gt;
            &lt;wsdl:output&gt;&lt;soap:body use="literal"/&gt;&lt;/wsdl:output&gt;
        &lt;/wsdl:operation&gt;
    &lt;/wsdl:binding&gt;

    &lt;wsdl:service name="CustomWS"&gt;
        &lt;wsdl:port binding="CustomBinding" name="CustomPortService"&gt;
            &lt;soap:address location="???"/&gt;
        &lt;/wsdl:port&gt;
    &lt;/wsdl:service&gt;
&lt;/wsdl:definitions&gt;
</code></pre>
					</section>

				</section>

				<section>
					<section>
						<h2>3. JAX-WS</h2>
						<ol>
							<li>Overview</li>
							<li>Exposing WS (server side)</li>
							<li>Consuming WS (client side)</li>
							<li>Advanced issues</li>
						</ol>
					</section>

					<section>
						<h3>3.1 Overview</h3>
						<p align="left"><a href="http://en.wikipedia.org/wiki/Java_API_for_XML_Web_Services" alt="Link of JAX-WS on Wikipedia">Java API for XML Web Services</a> (JAX-WS) is Java specification 
							(defined as <a href="http://jcp.org/en/jsr/detail?id=224" alt="Link to JSR-224">JSR-224</a>) of webservices.</p>
						<p align="left">There are many implementations (vendors): Metro project (reference implementation), CXF, Axis, Oracle Weblogic, etc.</p>
					</section>

					<section>
						<h3>3.2 Exposing WS</h3>
						<h4>[Server side]</h4>
						<ol>
							<li>Annotations for server side</li>
							<li>Contract Last - implementation from Java</li>
							<li>Contract First - implementation from WSDL</li>
							<li>Custom processing - custom processing of SOAP message</li>
						</ol>
					</section>
					<section>
						<h3>3.2.1 Annotations</h3>
						<h4>[Server side]</h4>
						<ul>
							<li><strong>@Webservice</strong> - expose WS with embedded marshalling (done by the server)</li>
							<li><strong>@WebServiceProvider</strong> - expose WS, but handle service completely (from XML request to XML response)</li>
						</ul>
					</section>
					<section>
						<h3>3.2.2 Contract Last</h3>
						<h4>[Server side]</h4>
						<p align="left">Use the annotation <strong>@WebService</strong> with all desired parameters (service name, port name, methods, etc.).</p>
						<pre><code class="java">@WebService(serviceName = "HelloService", portName = "HelloPort", 
			targetNamespace = "urn:com:asseco:aha:training:ws:v1")
public class HelloWebService implements HelloService {

	@WebMethod
	public String sayHello(String name) {
		return String.format("Spring say: Hello %s!", name);
	}

}</code></pre>
					</section>
					<section>
						<h3>3.2.3 Contract First</h3>
						<h4>[Server side]</h4>
						<p align="left">Use the annotation <strong>@WebService</strong> only with definition of the generated interface.</p>
						<pre><code class="java">@WebService(endpointInterface = "com.asseco.aha.training.ws.v1.HelloService")
public class HelloWebService implements HelloService {

	@WebMethod
	public String sayHello(String name) {
		return String.format("Spring say: Hello %s!", name);
	}

}</code></pre>
					</section>
					<section>
						<h3>3.2.4 Custom Processing</h3>
						<h4>[Server side]</h4>
						<p align="left">Use the annotation <strong>@WebServiceProvider</strong> with all message parameters to be applied for.</p>
						<pre><code class="java">@javax.xml.ws.ServiceMode(value = javax.xml.ws.Service.Mode.MESSAGE)
@WebServiceProvider(wsdlLocation = "wsdl/foo.wsdl", 
    serviceName = "...", portName = "...", targetNamespace = "...")
public class ProviderWebService implements Provider&lt;SOAPMessage&gt; {


	@Override
	public SOAPMessage invoke(SOAPMessage request) {
		...
	}</code></pre>
						<h4 align="left">Service modes:</h4>
						<ul>
							<li>MESSAGE - complete message</li>
							<li>PAYLOAD - payload only</li>
						</ul>
					</section>
					
					<section>
						<h3>3.3 Consuming WS</h3>
						<h4>[Client side]</h4>
						<ol>
							<li>Annotations for server side</li>
							<li>Generated client - generated by JAX-WS RI</li>
							<li>General client - provided by JAX-WS RI</li>
							<li>Spring client - spring way</li>
						</ol>
					</section>
					<section>
						<h3>3.3.1 Annotations</h3>
						<h4>[Client side]</h4>
						<ul>
							<li><strong>@WebServiceClient</strong> - consume/call WS</li>
						</ul>
					</section>
					<section>
						<h3>3.3.1 Generated client</h3>
						<h4>[Client side]</h4>
						<p align="left">Use generated classes to create WS instance and get the port from there.</p>
						<pre><code class="java">public class HelloWorldClient{
    public static void main(String[] args) throws Exception {
 		URL url = new URL("http://localhost:8080/ws-server-as/CalculatorWebService?WSDL");
		QName qname = new QName("http://ws.server.ws.training.aha.asseco.com/", "CalculatorWebServiceService");

		WsTraining service = new WsTraining(url, qname);
		WsTrainingPortType calc = service.getPort(WsTrainingPortType.class);

		AddRequest ar = new AddRequest();
		List<Integer> inputs = ar.getNumber();
		inputs.add(5);
		inputs.add(2);

		AddResponse response = calc.add(ar);
		Assert.assertEquals(7, response.getResult());
 
    }
 
}</code></pre>
					</section>
					<section>
						<h3>3.3.2 Runtime client</h3>
						<h4>[Client side]</h4>
						<p align="left">Use <strong>Service</strong> classe to create WS instance and get the port from there.</p>
						<pre><code class="java">public class HelloWorldClient{
 
    public static void main(String[] args) throws Exception {
 
        URL url = new URL("http://localhost:8080/ws-server-as/HelloWebService?WSDL");
        QName qname = new QName("http://ws.server.ws.training.aha.asseco.com/", "HelloWebServiceService");
 
        Service service = Service.create(url, qname);
        HelloWorld hello = service.getPort(HelloWorld.class);
 
        System.out.println(hello.sayHello("Arny"));
 
    }
 
}</code></pre>
					</section>
					<section>
						<h3>3.3.3 Spring client</h3>
						<h4>[Client side]</h4>
						<p align="left">Define client with Spring support.</p>
						<pre><code class="xml"><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd">
    <bean id="smsKlasWS" class="org.springframework.remoting.jaxws.JaxWsPortProxyFactoryBean" >
		&lt;property name="portName" value="AbcPort"/&gt;
		&lt;property name="serviceName" value="AbcService"/&gt;
		&lt;property name="namespaceUri" value="com.asseco.aha.training.ws.v1"/&gt;
		&lt;property name="serviceInterface" value="com.asseco.aha.training.ws.v1.AbcService"/&gt;
		&lt;property name="wsdlDocumentUrl" value="${endpoints.abcService}?wsdl"/&gt;
		&lt;property name="lookupServiceOnStartup" value="false"/&gt;
        <property name="customProperties">
            <util:map>
                <entry key="javax.xml.ws.client.receiveTimeout">
                    <value type="java.lang.Integer">300000</value>
                </entry>
            </util:map>
        </property>
    </bean>
</beans></code></pre>
					</section>

					<section>
						<h3>3.4 Advanced Issues</h3>
						<ol>
							<li>Advanced annotations</li>
							<li>Handler Chain</li>
							<li>MTOM</li>
							<li>WS-Addressing</li>
						</ol>
					</section>
					<section>
						<h3>3.4.1 Advanced annotations</h3>
						<ul>
							<li><strong>@HandlerChain</strong> - get access to message content (e.g. for logging, authorization, modification, etc.)</li>
							<li><strong>@MTOM</strong> - serve/consume bigger content as attachments (instead of encoded text)</li>
						</ul>
					</section>
					<section>
						<h3>3.4.2 Handler Chain</h3>
						Handler definition:
						<pre><code class="java">public class WsLoggingHandler implements SOAPHandler&lt;SOAPMessageContext&gt; {
    @Override
    public boolean handleMessage(SOAPMessageContext context) {
        ...
    }
}</code></pre>
						XML definition:
						<pre><code class="xml"><?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<javaee:handler-chains xmlns:javaee="http://java.sun.com/xml/ns/javaee"	xmlns:xsd="http://www.w3.org/2001/XMLSchema">
    <javaee:handler-chain>
        <javaee:handler>
            <javaee:handler-class>com.asseco.aha...util.WsLoggingHandler</javaee:handler-class>
        </javaee:handler>
    </javaee:handler-chain>
</javaee:handler-chains></code></pre>
						Usage:
						<pre><code class="java">@WebService(...)
@HandlerChain(file = "/handler-chain.xml")
public class CalculatorWebService implements WsTrainingPortType {
    ...
}</code></pre>
					</section>

					<section>
						<h3>3.4.3 MTOM</h3>
						Service:
						<pre><code class="java">@WebService
@MTOM(threshold = 1024)
public class LoremWebService {
    ...
}</code></pre>
						Client:
						<pre><code class="java">@Test
public void testCalc() throws MalformedURLException {
    URL url = new URL("http://localhost:8080/ws-server-as/CalculatorWebService?WSDL");
    QName qname = new QName("http://ws.server.ws.training.aha.asseco.com/", "CalculatorWebServiceService");

    Service service = Service.create(url, qname);
    WsTrainingPortType calc = 
	    service.getPort(WsTrainingPortType.class, new MTOMFeature());

    ...
}</code></pre>
					</section>

					<section>
						<h3>3.4.4 WS-Addressing</h3>
						Service:
						<pre><code class="java">@WebService
@Addressing(true, false) // enabled , required
public class HelloWebService {
    ...
}</code></pre>
						Request:
						<pre><code class="xml">POST http://localhost:8080/ws-server-as/HelloWebService HTTP/1.1
SOAPAction: ""
...

<soapenv:Envelope ...>
   <soapenv:Header xmlns:wsa="http://www.w3.org/2005/08/addressing">
      <wsa:Action>http://ws.server.ws.training.aha.asseco.com/HelloWebService/sayHello</wsa:Action>
      <wsa:ReplyTo><wsa:Address>http://localhost:8080/ws-server-as/EndpointService</wsa:Address></wsa:ReplyTo>
	  <wsa:MessageID>12345</wsa:MessageID>
   </soapenv:Header>
   <soapenv:Body>
      ...
   </soapenv:Body>
</soapenv:Envelope>
</code></pre>
					</section>

				</section>

				<section>
					<section>
						<h2>4. CXF</h2>
						<ol>
							<li>Overview</li>
							<li>Setup</li>
							<li>Exposing WS</li>
							<li>Interceptors</li>
						</ol>
					</section>
				
					<section>
						<h3>4.1 Overview</h3>
						<p align="left"><a href="http://cxf.apache.org/" alt="CXF web site">Apache CXF</a> is an open source services framework. CXF helps you build and develop services using frontend programming APIs, 
						like JAX-WS and JAX-RS. These services can speak a variety of protocols such as SOAP, XML/HTTP, RESTful HTTP, or CORBA and work over a variety of transports 
						such as HTTP, JMS or JBI.</p>
						<aside class="notes">URL is usually http://localhost:8080/ws-server-cxf/services</aside>
					</section>
					<section>
						<h3>4.2 Setup</h3>
						<p align="left">Maven dependency:</p>
						<pre><code class="java">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt;
    &lt;artifactId&gt;cxf-rt-frontend-jaxws&lt;/artifactId&gt;
    &lt;version&gt;3.0.2&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
						<p align="left">CXF configuration (via Spring):</p>
						<pre><code class="java">&lt;beans ...
    xmlns:jaxws="http://cxf.apache.org/jaxws"
    xsi:schemaLocation="... http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd"&gt;

    &lt;jaxws:endpoint ... address="/MyEndpoint"/&gt;
&lt;/beans&gt;</code></pre>
					</section>
					<section>
						<h3>4.3 Exposing WS</h3>
						<h4>[Server side]</h4>
						<ol>
							<li>Contract Last - implementation from Java</li>
							<li>Contract First - implementation from WSDL</li>
							<li>Custom processing - custom processing of SOAP message</li>
						</ol>
					</section>

					<section>
						<h3>4.3.1 Contract Last</h3>
						<h4>[Server side]</h4>
						<ul>
							<li>Prepare WSDL and generate classes</li>
							<li>Implement generated interface</li>
							<li>Use implemented class as:
						<pre><code class="xml">&lt;jaxws:endpoint id="calcWS" 
    implementor="com.asseco.aha.training.ws.server.ws.CalculatorWebService"
    address="/CalculatorWebService"/&gt;</code></pre>
							</li>
						</ul>
					</section>
					<section>
						<h3>4.2.2 Contract First</h3>
						<h4>[Server side]</h4>
						<ul>
							<li>Prepare Spring bean (desired method annotated with <strong>@WebMethod</strong>). E.g. as:
						<pre><code class="java">@Component("loremBean")
public class LoremWebService {
    @WebMethod
    public byte[] generate(int paraCount) {
        ...
    }
}</code></pre>
							</li>
							<li>Use implemented bean as:
						<pre><code class="xml">&lt;jaxws:endpoint id="loremWS" implementor="#loremBean" 
    address="/LoremWebService"&gt;
    &lt;jaxws:properties&gt;
        &lt;entry key="mtom-enabled" value="true" /&gt;
        &lt;entry key="source-preferred-format" value="dom"/&gt;
        &lt;entry key="schema-validation-enabled" value="false"/&gt;
        &lt;entry key="faultStackTraceEnabled" value="true"/&gt;
        &lt;entry key="exceptionMessageCauseEnabled" value="true"/&gt;
    &lt;/jaxws:properties&gt;
&lt;/jaxws:endpoint&gt;</code></pre>
							</li>
						</ul>
					</section>
					<section>
						<h3>4.2.3 Custom Processing</h3>
						<h4>[Server side]</h4>
						<ul>
							<li>Prepare Spring bean (desired method annotated with <strong>@WebMethod</strong>). E.g. as:
						<pre><code class="java">@Component("providerBean")
@javax.xml.ws.ServiceMode(value = javax.xml.ws.Service.Mode.PAYLOAD)
@WebServiceProvider
public class ProviderWebService implements Provider<Source> {
    @Override
    public Source invoke(Source request) {
        ...
    }
}</code></pre>
							</li>
							<li>Use implemented bean as:
						<pre><code class="xml">&lt;jaxws:endpoint id="providerWS"
    implementor="#providerBean" address="/ProviderWebService"
    wsdlLocation="classpath:wsdl/ws-training-provider.wsdl"
    xmlns:a="urn:com:asseco:aha:training:ws:provider:srv:v1"
    serviceName="a:ProviderService" endpointName="a:ProviderPort"/&gt;
</code></pre>
							</li>
						</ul>
					</section>
					<section>
						<h3>4.3 Interceptors</h3>
						<pre><code class="java">&lt;beans ...
    xmlns:cxf="http://cxf.apache.org/core"
    xsi:schemaLocation="... http://cxf.apache.org/core http://cxf.apache.org/schemas/core.xsd"&gt;

    &lt;import resource="classpath:META-INF/cxf/cxf.xml" /&gt;
    &lt;bean id="logInbound" class="org.apache.cxf.interceptor.LoggingInInterceptor" /&gt;
    &lt;bean id="logOutbound" class="org.apache.cxf.interceptor.LoggingOutInterceptor" /&gt;

    &lt;cxf:bus&gt;
        &lt;cxf:inInterceptors&gt;
            &lt;ref bean="logInbound" /&gt;
        &lt;/cxf:inInterceptors&gt;
        &lt;cxf:outInterceptors&gt;
            &lt;ref bean="logOutbound" /&gt;
        &lt;/cxf:outInterceptors&gt;
        &lt;cxf:inFaultInterceptors&gt;
            &lt;ref bean="logInbound" /&gt;
        &lt;/cxf:inFaultInterceptors&gt;
        &lt;cxf:outFaultInterceptors&gt;
            &lt;ref bean="logOutbound" /&gt;
        &lt;/cxf:outFaultInterceptors&gt;
    &lt;/cxf:bus&gt;

&lt;/beans&gt;</code></pre>
					</section>
		
				</section>
				
				<section>
					<section>
						<h2>5. Implementation</h2>
						<ol>
							<li>Prerequisites</li>
							<li>Build model</li>
							<li>Implementation</li>
							<li>Lab</li>
						</ol>
					</section>

					<section>
						<h3>5.1 Prerequisites</h3>
						<table style="border: 1px solid white;">
							<tr style="background-color: gray;">
								<th>Item</th>
								<th>Tool/Framework</th>
								<th>Version</th>
							</tr>
							<tr>
								<td>Java</td>
								<td>Oracle JDK</td>
								<td>7</td>
							</tr>
							<tr>
								<td>Build tool</td>
								<td>Maven</td>
								<td>3.x</td>
							</tr>
							<tr>
								<td>IoC</td>
								<td>Spring Framework</td>
								<td>4.1</td>
							</tr>
							<tr>
								<td rowspan="3">Application Server</td>
								<td>WildFly</td>
								<td>8.1.x</td>
							</tr>
							<tr>
								<td>JBoss</td>
								<td>7.1.1</td>
							</tr>
							<tr>
								<td>Tomcat</td>
								<td>7.0.28</td>
							</tr>
							<tr>
								<td>Unit testing</td>
								<td>JUnit</td>
								<td>4.11</td>
							</tr>
							<tr>
								<td>Logging</td>
								<td>slf4j / log4j</td>
								<td>1.7.x / 1.2.x</td>
							</tr>
							<tr>
								<td>Test client (UI)</td>
								<td>SoapUI</td>
								<td>5.x</td>
							</tr>
						</table>
					</section>
					
					<section>
						<h2>5.2 Build model</h2>
						<img src="img/webservices-build_model.png" alt="Maven build model">
					</section>

					<section>
						<h2>5.3 Implementation</h2>
						<p>Check <a href="https://github.com/arnosthavelka/ws-training" alt="Souce code for lab">source code</a> ...</p>
					</section>

					<section>
						<h2>5.4 Lab (Exercise)</h2>
						<ul>
							<li>Write WS (contract last)</li>
							<li>Write WS (contract first)</li>
							<li>Write client</li>
						</ul>
					</section>

				</section>
				
				<section>
					<section>
						<h2>6. Exposing WS</h2>
						<h3>[In different setups]</h3>
						<ol>
							<li>Wildfly</li>
							<li>JBoss</li>
							<li>Tomcat</li>
							<li>Spring boot (embedded Tomcat)</li>
							<li>Spring exporter</li>
							<li>CXF</li>
							<li>JAX-WS Endpoint</li>
						</ol>
					</section>

					<section>
						<h3>6.1 Wildfly</h3>
						<ul>
							<li>WS itself (<strong>@WebService</strong>) works out of box (Wildfly is full AS)</li>
							<li>The integration of WS with Spring can be done in ancestor (<strong>@PostConstruct</strong> inheritance is working)</li>
							<li>AS modifies WSDL (service name, target namespace, etc.) when not explicitly specified.</li>
						</ul>
					</section>
					
					<section>
						<h3>6.2 JBoss</h3>
						<ul>
							<li>Same as Wildfly (see chapter 6.1)</li>
							<li>Except usage of <strong>@WebServiceProvider</strong> - XSD include is not working (expected root is in WEB-INF directory)</li>
						</ul>
					</section>
					
					<section>
						<h2>6.3 Tomcat</h2>
						<ul>
							<li>Tomcat is web-container. Therefore we need to add JAX-WS runtime libraries into <strong>%tomcat_home%/lib</strong> (approx. 32 files).</li>
							<li>Web application must be modified as:
								<ul>
									<li>Modify file <strong>web.xml</strong> to add listener <strong>WSServletContextListener</strong>.</li>
									<li>Add file <strong>sun-jaxws.xml</strong> to defined exposed WS endpoints.</li>
								</ul>
							</li>
							<li>Spring integration (to WS) has to be done in every WS (@PostConstruct <strong>inheritance does not work</strong>)</li>
						</ul>
					</section>

					<section>
						<h2>6.4 Spring boot</h2>
						<h3>[Embedded Tomcat]</h3>
						<ul>
							<li>REST service is fine (working out of box) - just define spring context and REST controller.
								<pre><code class="java">@RestController
public class HelloRestService {

	@RequestMapping("/hello")
	public String sayHello(String name) {
	  ... 
	}

}</code></pre></li>
							<li>However SOAP service does not work for me (up to now)!</li>
						</ul>
					</section>

					<section>
						<h2>6.5 Spring exporter</h2>
						<ul>
							<li>Easy to use, but not working in the same context as AS (aka same port).</li>
							<li>Definition of the spring bean (exporter).
						<pre><code class="xml"><beans xmlns="http://www.springframework.org/schema/beans" ...>
  &lt;bean class="org.springframework.remoting.jaxws.SimpleJaxWsServiceExporter" 
        p:baseAddress="http://localhost:9999/myServices" /&gt;
</beans></code></pre></li>
							<li>WS has to be defined as spring bean.
						<pre><code class="java">@Component
@WebService(...)
public class CalculatorWebService implements WsTrainingPortType {
  ...
}</code></pre></li>
						</ul>
					</section>

					<section>
						<h2>6.5 CXF</h2>
						<ul>
							<li>Easy to use (even outside AS), but working independently.</li>
							<li>Necessary to define servlet listener (similar to JAX-WS on Tomcat)</li>
							<li>Easy integration to Spring, but most integration is in XML</li>
						</ul>
					</section>
					<section>
						<h2>6.6 JAX-WS Endpoint</h2>
						<ul>
							<li>Easy to use (completely in our hands)</li>
							<li>Probably no integration to Spring</li>
						</ul>
						<pre><code class="java">public static void main(String[] args) {
    Endpoint.publish("http://localhost:9999/ws/calc", 
        new CalculatorWebService());
}</code></pre>
					</section>
				</section>
				
				<section>
					<section>
						<h2>7. Microservices</h2>
						<ol>
							<li>Overview</li>
							<li>Scaling</li>
							<li>Decentralized Data Management</li>
							<li>Evolutionary Design</li>
						</ol>
						<br/><br/>
						<small>Based on <a href="http://martinfowler.com/articles/microservices.html" alt="Source link">Martin Fowler: Microservices</a></small>
					</section>

					<section>
						<h2>7.1 Overview</h2>
						<ul>
							<li>The application is a suite of small services.</li>
							<li>The implementation of each application can be done (written) with different programming languages (even can  be managed by different teams).</li>
							<li>The services are independently deployable and scalable, each service also provides a firm module boundary.</li>
							<li>Elimination of "Single point of failure".</li>
							<li>Minimum of centralized management (e.g. ESB, BPEL, etc.).</li>
							<li>Decentralized Data Management</li>
						</ul>
					</section>

					<section>
						<h2>7.2 Scaling</h2>
						<img src="img/webservices-sketch.png" alt="Scaling of microservices"/>
					</section>

					<section>
						<h2>7.3 Decentralized Data Management</h2>
						<img src="img/webservices-decentralised-data.png" alt="Decentralized Data Management by microservices"/>
					</section>

					<section>
						<h2>7.4 Evolutionary Design</h2>
						<ol>
							<li>Independent replacement and upgradeability (e.g. rewriting a component without affecting its collaborators).</li>
							<li>Move service between component based on component's cohesion, service's stability, release plan, etc.</li>
							<li>Add new features as a new service (useful for temporary solutions - it can be removed easily).</li>
							<li>Component vs. Service - when some services are usually changed together then they shall be handled as 1 component.</li>
						</ol>
					</section>
					
				</section>
				
				<section>
					<section>
						<h2>8. REST</h2>
						<ol>
							<li>Overview</li>
							<li>Principles</li>
							<li>Methods</li>
							<li>HATOES</li>
							<li>Implementation</li>
						</ol>
						<br/><br/>
						<small>Based on <a href="http://en.wikipedia.org/wiki/Representational_state_transfer" alt="Description of REST on Wikipedia">Wikipedia</a> and <a href="http://www.restapitutorial.com/" alt="Web REST API Tutorial">REST API Tutorial</a></small>
					</section>

					<section>
						<h2>8.1 Overview</h2>
						<p align="left"><strong>Representational state transfer</strong> known as REST is a new architecture approach to create web services.</p>
						<p align="left">The concept is based on:
							<ul>
								<li>Proper usage of HTTP features</li>
								<li>All is about (stateless) resources (URI)</li>
								<li>URL represents resource, not an action</li>
								<li>Easy and efficient use, but without strict</li>
								<li>Support for multiple format - what server accepts and client prefers (e.g. XML, JSON, CSV, TXT, etc.)</li>
							</ul>
						</p>
					</section>

					<section>
						<h2>8.2 Principles</h2>
						<ul>
							<li><strong>Uniform interface</strong>
								<ul>
									<li>Resource-Based</li>						
									<li>Manipulation of Resources Through Representations</li>						
									<li>Self-descriptive Messages</li>						
									<li>Hypermedia as the Engine of Application State (<a href="http://en.wikipedia.org/wiki/HATEOAS" alt="Description of HATEOAS on Wikipedia">HATEOAS</a>)</li>						
								</ul>
							</li>
							<li><strong>Client‚Äìserver</strong> - the separation of clients from servers.</li>
							<li><strong>Stateless</strong> - no state is hold on server-side.</li>
							<li><strong>Cacheable</strong> - clients can cache responses.</li>
							<li><strong>Layered system</strong> - clients do not know whether they are connected directly to the end server (or not).</li>
							<li><strong>Code on demand (optional)</strong> - servers can temporarily extend or customize the functionality of a client by the transfer of executable code (Java applets, JS, etc.).</li>
						</ul>
					</section>

					<section>
						<h2>8.3 Methods</h2>
						<table style="border: 1px solid white;">
							<tr style="background-color: gray;">
								<th>HTTP Method</th>
								<th>Funtion</th>
								<th>Description</th>
							</tr>
							<tr>
								<td>GET</td>
								<td>Read/Select</td>
								<td>Retrieves a resource</td>
							</tr>
							<tr>
								<td>PUT</td>
								<td>Update/Create</td>
								<td>Creates or updates resource for known ID (overwrite action) - idempotent / repeatable action</td>
							</tr>
							<tr>
								<td>POST</td>
								<td>Create/Update/Add</td>
								<td>Creates or updates resource for unknown ID (ID can to be predicted)- <strong>NOT idempotent</strong></td>
							</tr>
							<tr>
								<td>DELETE</td>
								<td>Delete/Remove</td>
								<td>Deletes a resource</td>
							</tr>
							<tr>
								<td>OPTION</td>
								<td>Document API</td>
								<td>Provide documentation to exposed API (URL)</td>
							</tr>
						</table>
						<small>More information <a href="http://www.restapitutorial.com/lessons/httpmethods.html" alt="Using HTTP Methods for RESTful Services">here</a></small>
					</section>
					<section>
						<h2>8.4 HATOES</h2>
						<p align="left">Hypermedia as the Engine of Application State (<a href="http://en.wikipedia.org/wiki/HATEOAS" alt="Description of HATEOAS on Wikipedia">HATEOAS</a>) represents 
						another network application architecture. The principle is that a client interacts with a network application entirely through hypermedia provided dynamically by application servers.</p>
						<pre>Example request:<code class="xml">GET /book/12345 HTTP/1.1
Host: coollibrary.com
Accept: application/json
...</code></pre>
						<pre>Example response:<code class="xml">HTTP/1.1 200 OK
Content-Type: application/json
Response-Body:
{"id": "54321", "title": "Jurassic Park", "author": "Michael Crichton", "status": "available",
"links": [
{"rel": "self", "method": "get",
"href": "http://coollibrary.com/book/54321"},
{"rel": "borrow", "method": "put",
"href": "http://coollibrary.com/book/54321/borrow"},
{"rel": "reserve", "method": "put",
"href": "http://coollibrary.com/book/54321/reserve"},
{"rel": "discard", "method": "delete",
"href": "http://coollibrary.com/book/54321/discard"}
]}</code></pre>
					</section>
					<section>
						<h2>8.5 Implementation</h2>
						<p>Check <a href="https://github.com/arnosthavelka/ws-training" alt="Souce code for lab">source code</a> ...</p>
					</section>
					
				</section>

				<section>
					<h1>THE END</h1>
					<h3>Thank you!</h3>
				</section>

			</div>

		</div>
		
		<script src="../reveal.js/dist/reveal.js"></script>
		<script src="../reveal.js/plugin/highlight/highlight.js"></script>
		<script>
			Reveal.initialize({
				center: true,
				hash: true,
				plugins: [ RevealHighlight ]
			});
		</script>

	</body>
</html>
